<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>Bookings</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

    <script>
        /* Toggle hidden detail row */
        function toggleDetails(id) {
            const row = document.getElementById(id);
            row.style.display = row.style.display === "table-row" ? "none" : "table-row";
        }
    </script>
</h:head>

<h:body style="background:#f7f7f7;">

    <div class="container mt-5">

        <h2 class="mb-4 text-center">Booking List</h2>

        <div class="card shadow">
            <div class="card-body">

                <table class="table table-striped table-hover align-middle">

                    <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Customer</th>
                        <th>Car</th>
                        <th>Status</th>
                        <th>Payment</th>
                        <th>Date Range</th>
                        <th>Total</th>
                        <th class="edit-col">Actions</th>
                    </tr>
                    </thead>

                    <tbody>
                    <ui:repeat value="#{orderBean.orders}" var="b" varStatus="vs">

                        <!-- Clickable row -->
                        <tr onclick="toggleDetails('detail#{vs.index}')">
                            <td>#{b.bookingId}</td>
                            <td>#{b.customer.firstName} #{b.customer.lastName}</td>
                            <td>#{b.car.carType.brand} #{b.car.carType.model}</td>
                            <td>#{b.bookingStatus}</td>
                            <td>#{b.paymentStatus}</td>
                            <td>#{b.startDate} → #{b.endDate}</td>
                            <td>CHF #{b.totalCost}</td>

                            <!-- Fixed right-side buttons -->
                            <td class="edit-col">
                                <div class="btn-group" role="group">

                                    <!-- Delete button -->
                                    <h:form>
                                        <h:commandLink value="Cancel" styleClass="btn btn-danger btn-sm"
                                                       action="#{orderBean.cancelOrder}"
                                                       onclick="return confirm('Are you sure you want to delete this booking?');"/>
                                    </h:form>

                                </div>
                            </td>
                        </tr>

                        <!-- Hidden detail row -->
                        <tr id="detail#{vs.index}" class="details-row" style="display:none;">
                            <td colspan="8" class="details-cell">

                                <!-- Customer Info -->
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">
                                        <strong>Customer Information</strong>
                                    </div>
                                    <div class="card-body">

                                        <p><strong>Name:</strong>
                                            #{b.customer.firstName} #{b.customer.lastName}
                                        </p>

                                        <p><strong>Email:</strong> #{b.customer.email}</p>
                                        <p><strong>Phone:</strong> #{b.customer.phoneNumber}</p>

                                        <p><strong>Age:</strong> #{b.customer.age}</p>

                                        <p><strong>Verified Identity:</strong>
                                            #{b.customer.verifiedIdentity ? 'Yes' : 'No'}
                                        </p>

                                        <p><strong>Billing Address:</strong> #{b.customer.billingAddress}</p>

                                        <p><strong>Driving License Number:</strong> #{b.customer.drivingLicenseNumber}</p>
                                        <p><strong>License Expiry:</strong> #{b.customer.drivingLicenseExpiryDate}</p>

                                        <p><strong>Account Balance:</strong> CHF #{b.customer.balance}</p>

                                        <p><strong>Customer Since:</strong> #{b.customer.creationDate}</p>
                                    </div>
                                </div>

                                <!-- Car Info -->
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <strong>Car Information</strong>
                                    </div>
                                    <div class="card-body">

                                        <p><strong>Car:</strong>
                                            #{b.car.carType.brand} #{b.car.carType.model}
                                        </p>

                                        <p><strong>VIN:</strong> #{b.car.vin}</p>
                                        <p><strong>License Plate:</strong> #{b.car.licensePlate}</p>
                                        <p><strong>Color:</strong> #{b.car.color}</p>

                                        <p><strong>Category:</strong> #{b.car.carType.category}</p>
                                        <p><strong>Seats:</strong> #{b.car.carType.seats}</p>
                                        <p><strong>Transmission:</strong> #{b.car.carType.transmission}</p>
                                        <p><strong>Drive Type:</strong> #{b.car.carType.driveType}</p>

                                        <p><strong>Engine:</strong> #{b.car.carType.engine}</p>
                                        <p><strong>Power:</strong> #{b.car.carType.power} HP</p>
                                        <p><strong>Acceleration 0–100:</strong> #{b.car.carType.acceleration} sec</p>
                                        <p><strong>Max Speed:</strong> #{b.car.carType.maxSpeed} km/h</p>

                                        <p><strong>Daily Rental Price:</strong> CHF #{b.car.dailyRentalPrice}</p>
                                        <p><strong>Deposit Amount:</strong> CHF #{b.car.depositAmount}</p>

                                        <p><strong>Insurance Expiry:</strong> #{b.car.insuranceExpiryDate}</p>
                                        <p><strong>Last Maintenance:</strong> #{b.car.lastMaintenanceDate}</p>
                                        <p><strong>Registration Date:</strong> #{b.car.registrationDate}</p>

                                        <!-- Car Features -->
                                        <p><strong>Features:</strong></p>
                                        <ul>
                                            <ui:repeat value="#{b.car.carType.features}" var="f">
                                                <li>#{f}</li>
                                            </ui:repeat>
                                        </ul>

                                        <!-- Image -->
                                        <div class="mt-3">
                                            <img src="#{b.car.imageUrl}"
                                                 alt="Car Image"
                                                 class="img-fluid rounded"
                                                 style="max-width: 250px;" />
                                        </div>

                                    </div>
                                </div>

                            </td>
                        </tr>

                    </ui:repeat>
                    </tbody>

                </table>

            </div>
        </div>

    </div>

</h:body>
</html>